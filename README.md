# Last War 副大統領自動任命ツール

このプログラムは、BlueStacksエミュレーター上で動作するモバイルゲーム「Last War」の副大統領任命作業を自動化するツールです。

## 機能概要

- **自動任命機能**: 建造、科学、内務、防衛、戦略の各部門に副大統領を自動的に任命
- **スクリーンショット監視**: 定期的にゲーム画面のスクリーンショットを撮影し、AWS S3に保存
- **異常検知**: 画像類似度分析により、ゲーム画面の異常（迷子状態）を検知
- **メール通知**: 異常検知時に指定されたメールアドレスに通知
- **自動復旧**: BlueStacksの自動再起動機能
- **メンテナンスモード**: リモートからの操作を可能にするモード

## 必要環境

- Python 3.6以上
- BlueStacks App Player
- AWS S3アカウント
- 以下のPythonパッケージ:
  - boto3
  - pyautogui
  - pygetwindow
  - opencv-python (cv2)
  - numpy
  - scikit-image (オプション: SSIM計算用)

## セットアップ

1. 必要なパッケージをインストール:
```
pip install boto3 pyautogui pygetwindow opencv-python numpy scikit-image
```

2. AWS S3バケットを作成し、アクセス権限を設定

3. プログラム内の以下の設定を環境に合わせて変更:
   - `bucket_name`: S3バケット名
   - `gmail_user`: 送信元メールアドレス
   - `gmail_password`: Gmailアプリパスワード
   - `recipient_email`: 通知先メールアドレス

4. BlueStacksの設定:
   - インスタンス名: Pie64
   - アプリ: com.fun.lastwar.gp

## 使用方法

1. BlueStacksを起動し、Last Warにログイン

2. プログラムを実行:
```
python vpbot.py
```

3. プログラムはバックグラウンドで動作し、定期的に副大統領の任命とスクリーンショットの撮影を行います

## リモート制御機能

S3バケット内の以下のファイルを編集することで、リモートからプログラムの動作を制御できます:

- `vpflg.txt`: 
  - `0`: 通常動作
  - `1`: 副大統領任命
  - `2`: キック実行
  - `3`: 強制再起動
  - `4`: メンテナンスモード

- `coordinates.txt`: メンテナンスモード中に、このファイルに座標（例: `330,450`）を書き込むと、その位置をクリックします

## 注意事項

- このプログラムはBlueStacksの特定の画面解像度と配置を前提としています
- 画面レイアウトが変更された場合は、座標値の調整が必要です
- Gmailアプリパスワードは定期的に更新することをお勧めします

## ファイル構成

- `vpbot.py`: メインプログラム
- `screenshots/`: スクリーンショット保存ディレクトリ
  - `screenshot-correct.png`: 正常状態の基準画像
  - `list.txt`: 最新スクリーンショットのリスト

## トラブルシューティング

- プログラムが正常に動作しない場合は、BlueStacksの解像度設定やウィンドウ位置を確認してください
- メール通知が届かない場合は、Gmailのアプリパスワードと設定を確認してください
- 画像類似度の閾値（`SIMILARITY_THRESHOLD`）は、必要に応じて調整してください
